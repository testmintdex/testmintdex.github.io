<style type=text/css>
.table-condensed{
  font-size: 15px;
}

table, td, th {
  border: 1px solid black;
}

table {
  border-collapse: collapse;
  width: 100%;
  font-size: 13px;
}

th {
  height: 30px;
}

.group {
  margin-bottom: 20px;
}
.group label {
  font-size: 10px;
}
.group2 label {
  font-size: 12px;
}

/* this is for placeholder to right justify */
::-webKit-input-placeholder { /* WebKit browsers */
    direction: rtl;
}
:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
    direction: rtl;
}
::-moz-placeholder { /* Mozilla Firefox 19+ but I'm not sure about working */
    direction: rtl;
}
:-ms-input-placeholder { /* Internet Explorer 10+ */
    direction: rtl;
}

/* This is to reduce margin left and right */
.container {
     padding-right: 0; /*15px in bootstrap.css*/
     padding-left: 0;  /*idem*/
     margin-right: auto;
     margin-left: auto;
}


/*
this version will try to address metamask stop injecting web3 after 16 Nov 2020. using recommendation from the web
https://ethereum.stackexchange.com/questions/79980/what-does-metamask-mean-by-stop-injecting-web3-js


*/

</style>

<html>
<head>
<title>mintDex</title>
<link rel="icon" href="mintdexlogo.png">

<script type=text/javascript src="web3.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
  
<script src="apexcharts.js"></script>



<div class="bs-1">
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a href="#" class="navbar-brand">
            <img src="mintdexlogo.png" height="28" alt="MintDex">
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav">  
				<a href="index.html" class="nav-item nav-link">Home</a>
				<a href="faucet.html"p class="nav-item nav-link">Faucet</a>
				<a href="mintdexc.html" class="nav-item nav-link active">MintDex (testnet)</a>
			</div> 
        </div>
    </nav>
</div> 

<div class="container-fluid">
<div class="row">
    <div class="col-md-3">
	Order Book
 <table id="idtableOrderBook"   align="right">
  <tr>
    <th >Price (USD)</th>
    <th  class="text-right">Amount (MINT)</th>
	 <th class="text-right">Total (USD)</th>
  </tr>

  <tr>
    <td  id="sell10price" onclick="fillbuy(10)"> </td><td  id="sell10amount" onclick="fillbuy(10)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>  
  <tr>
    <td  id="sell9price" onclick="fillbuy(9)"> </td><td  id="sell9amount" onclick="fillbuy(9)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell8price" onclick="fillbuy(8)"> </td><td  id="sell8amount" onclick="fillbuy(8)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell7price" onclick="fillbuy(7)"> </td><td  id="sell7amount" onclick="fillbuy(7)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell6price" onclick="fillbuy(6)"> </td><td  id="sell6amount" onclick="fillbuy(6)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  

  <tr>
    <td  id="sell5price" onclick="fillbuy(5)"> </td><td  id="sell5amount" onclick="fillbuy(5)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell4price" onclick="fillbuy(4)"> </td><td  id="sell4amount" onclick="fillbuy(4)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell3price" onclick="fillbuy(3)"> </td><td  id="sell3amount" onclick="fillbuy(3)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell2price" onclick="fillbuy(2)"> </td><td  id="sell2amount" onclick="fillbuy(2)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="sell1price" onclick="fillbuy(1)"> </td><td  id="sell1amount" onclick="fillbuy(1)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr  style="height:20px"> 
    <td colspan="3" bgcolor="pink" style="vertical-align:middle;font-size: 11pt; " class="text-center"><span style="font-weight:bold"> <i class="fas fa-spinner fa-spin"></i></span></td>  
  </tr>  
  <!-- 
   //// buy orders start, the first one is buy order 1
   --> 
  <tr>
    <td  id="buy1price" onclick="fillsell(1)"> </td><td  id="buy1amount" onclick="fillsell(1)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="buy2price" onclick="fillsell(2)"> </td><td  id="buy2amount" onclick="fillsell(2)" class="text-right"> </td><td class="text-right"> </td> 
  </tr> 
  
  <tr>
    <td  id="buy3price" onclick="fillsell(3)"> </td><td  id="buy3amount" onclick="fillsell(3)" class="text-right"> </td><td class="text-right"> </td> 
  </tr> 
  
  <tr>
    <td  id="buy4price" onclick="fillsell(4)"> </td><td  id="buy4amount" onclick="fillsell(4)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>  
  
  <tr>
    <td  id="buy5price" onclick="fillsell(5)"> </td><td  id="buy5amount" onclick="fillsell(5)" class="text-right"> </td><td class="text-right"> </td> 
  </tr> 
  
  <tr>
    <td  id="buy6price" onclick="fillsell(6)"> </td><td  id="buy6amount" onclick="fillsell(6)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="buy7price" onclick="fillsell(7)"> </td><td  id="buy7amount" onclick="fillsell(7)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="buy8price" onclick="fillsell(8)"> </td><td  id="buy8amount" onclick="fillsell(8)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="buy9price" onclick="fillsell(9)"> </td><td  id="buy9amount" onclick="fillsell(9)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>
  
  <tr>
    <td  id="buy10price" onclick="fillsell(10)"> </td><td  id="buy10amount" onclick="fillsell(10)" class="text-right"> </td><td class="text-right"> </td> 
  </tr>  
  
  
</table> 
    </div>
    <div class="col-md-6">
        <div class="row">
            <div class="col-md-12">
                <div id="myChart"  ></div>
            </div>
            
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="well">
				<form onsubmit="return false">
				<hr>
				Buy Limit Order
				 
				<small id="etherbalance1" class="form-text text-muted">You have 0 USD</small>				
				
				
				
				  
				  <div class="form-group row">
					<label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Price   </label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="pricebuy" placeholder="Price MINT/USD"  onkeydown="buyTotal()" onkeyup="buyTotal()">
					</div>
				  </div>
				  <div class="form-group row">
					<label for="colFormLabel" class="col-sm-2 col-form-label col-form-label-sm">Amount</label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="amountbuy" placeholder="MINT"  onkeydown="buyTotal()" onkeyup="buyTotal()">
					</div>
				  </div> 
				  <div class="form-group row">
					<label for="colFormLabel" class="col-sm-2 col-form-label col-form-label-sm">Total</label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="totalbuy" placeholder="USD"  disabled>
					</div>
				  </div>  
				  <button type="button" class="btn btn-primary btn-sm  btn-block" onclick="placebuyorder()">BUY MINT</button> 
				   



				  
				</form>	
				
				

				
<hr>				
<form onsubmit="return false">
  <div class="form-group">
    <label for="exampleInputEmail1">Deposit USD</label>
	<small id="depositusd" class="form-text text-muted"></small>	
    <input type="text" class="form-control form-control-sm" id="iddepositetheramount"  placeholder="Enter the deposit amount">
    <small id="emailHelp" class="form-text text-muted">Deposit USD to DEX Smart Contract</small>
  </div>
   
  <button  class="btn btn-primary btn-sm  btn-block" onclick="depositether()">Deposit USD</button>
   
</form>		
				
				
<hr>				
<form onsubmit="return false">
  <div class="form-group">
    <label for="exampleInputEmail1">Deposit MINT Tokens</label>
	<small id="deposittokenid" class="form-text text-muted"></small>	
    <input type="text" class="form-control form-control-sm" id="iddeposittokenamount"   placeholder="Enter the deposit amount">
    <small id="emailHelp" class="form-text text-muted">Deposit MINT Token to DEX Smart Contract</small>
  </div>
   
  <button  class="btn btn-primary btn-sm  btn-block" onclick="deposittoken()">Deposit MINT</button>
   
</form>						
				
				
				
				
				
				
				
				
				
				</div>
            </div>
            <div class="col-md-6">
                <div class="well">
<form onsubmit="return false">
				<hr>
				Sell Limit Order
				 
				<small id="gdfbalance1" class="form-text text-muted">You have 0 MINT</small>
				  <div class="form-group row">
					<label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Price</label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="pricesell" placeholder="Price MINT/USD"  onkeydown="sellTotal()" onkeyup="sellTotal()">
					</div>
				  </div>
				  <div class="form-group row">
					<label for="colFormLabel" class="col-sm-2 col-form-label col-form-label-sm">Amount</label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="amountsell" placeholder="MINT"  onkeydown="sellTotal()" onkeyup="sellTotal()">
					</div>
				  </div> 
				  <div class="form-group row">
					<label for="colFormLabel" class="col-sm-2 col-form-label col-form-label-sm">Total</label>
					<div class="col-sm-10">
					  <input type="email" class="form-control form-control-sm" id="totalsell" placeholder="USD"  disabled>
					</div>
				  </div>  
				  <button type="button" class="btn btn-primary btn-sm  btn-block" onclick="placesellorder()">SELL MINT</button>  
                   
				</form>	
				  
				  
<hr>		

		  
<form onsubmit="return false">
  <div class="form-group">
    <label for="exampleInputEmail1">Withdraw USD</label>
		<small id="withdrawusdid" class="form-text text-muted"></small>	
    <input type="text" class="form-control form-control-sm" id="idwithdrawetheramount" aria-describedby="emailHelp" placeholder="Enter the withdraw amount">
    <small id="emailHelp" class="form-text text-muted">Withdraw USD from DEX Smart Contract</small>
  </div>
   
  <button  class="btn btn-primary btn-sm  btn-block" onclick="withdrawether()">Withdraw USD</button>
   
</form>							
				
<hr>				
<form onsubmit="return false">
  <div class="form-group">
    <label for="exampleInputEmail1">Withdraw MINT Tokens</label>
		<small id="withdrawminttokenid" class="form-text text-muted"></small>	
    <input type="text" class="form-control form-control-sm" id="idwithdrawtokenamount" aria-describedby="emailHelp" placeholder="Enter the withdraw amount">
    <small id="emailHelp" class="form-text text-muted">Withdraw MINT Token from Smart Contract</small>
  </div>
   
  <button  class="btn btn-primary btn-sm  btn-block" onclick="withdrawtoken()">Withdraw MINT</button>
   
</form>				
				<button onclick="refreshOrderBook()" hidden>Refresh Orderbook</button>
 
				<button onclick="updatelasttradedprice() " hidden> Update Last Traded Price </button>
				<button onclick="plotdepthgraph()" hidden> Plot Graph </button>	 
				<button onclick="testReadEvent()" hidden> Test Read Event </button>				
				<button onclick="updatemarkethistory()" hidden> Update Market Histroy </button>						
				
				
				
				
				
				</div>
            </div>
        </div>
    </div>
	    <div class="col-md-3">
        <div class="well"> 
		
		Market Trade History
 <table id="tableMarketHistory"   align="right">
   
  <tr>
    <th >Price (USD)</th>
    <th  class="text-right">Amount (MINT)</th>
	 <th class="text-center"> Time </th>
  </tr>

  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>   
  

  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  			 
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>   
  

  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  			 
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>   
  

  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right" > </td>    
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>     
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>  
  </tr>
  
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>  			 
  <tr>
    <td> </td><td class="text-right"> </td><td class="text-right"> </td>    
  </tr>    
  
  
  
  
  
  
        </div>
    </div>
	
	
</div>
</div>

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
 
 
 
 
 
 
 
 
 
 
 
 
 <script>
var firsttime,previouslastradedprice,tablemarkethistroyrow,dextrade2,useraddr,defaultwalletaddress;document.onkeyup=function(e){77==e.which?getBalanceNow():e.ctrlKey&&66==e.which?updateApexChart():e.ctrlKey&&e.altKey&&89==e.which?alert("Ctrl + Alt + Y shortcut combination was pressed"):e.ctrlKey&&e.altKey&&e.shiftKey&&85==e.which&&alert("Ctrl + Alt + Shift + U shortcut combination was pressed")},window.addEventListener("load",init);var chart,lasttradedtimestamp,lasttradedprice,lasttradedamt,mingasprice="25000000000000",eth="0x0000000000000000000000000000000000000000",minttokenaddress="0xf8b10a9527d542ef7Fa32a0f8E556Ab5c050dd6c",myContractAddress="0x4F100922208D07d6c2A3FbB0B262E063f38B8064";function isNumber(e){return"number"==typeof e}function buyTotal(){var e=document.getElementById("pricebuy").value,t=document.getElementById("amountbuy").value;e=Number(e),t=Number(t),isNumber(e)&&isNumber(t)&&(total=e*t,document.getElementById("totalbuy").value=total.toFixed(6)+" USD")}function sellTotal(){var e=document.getElementById("pricesell").value,t=document.getElementById("amountsell").value;e=Number(e),t=Number(t),isNumber(e)&&isNumber(t)&&(total=e*t,document.getElementById("totalsell").value=total.toFixed(6)+" USD")}function test(){price=document.getElementById("sell1price").innerHTML,amount=document.getElementById("sell1amount").innerHTML,document.getElementById("pricesell").value=price,document.getElementById("amountsell").value=amount}function fillsell(e){var t="buy"+e+"price",n="buy"+e+"amount";price=document.getElementById(t).innerHTML,amount=document.getElementById(n).innerHTML,isNaN(price)||isNaN(amount)||(document.getElementById("pricesell").value=price,document.getElementById("amountsell").value=amount,sellTotal())}function fillbuy(e){var t="sell"+e+"price",n="sell"+e+"amount";price=document.getElementById(t).innerHTML,amount=document.getElementById(n).innerHTML,isNaN(price)||isNaN(amount)||(document.getElementById("pricebuy").value=price,document.getElementById("amountbuy").value=amount,buyTotal())}async function depositether(){amountinether=document.getElementById("iddepositetheramount").value,amount=web3.utils.toWei(amountinether.toString(),"ether"),console.log(amount);await dextrade2.methods.deposit().send({from:defaultwalletaddress,value:amount,gasPrice:mingasprice});setTimeout(function(){getBalance(useraddr,eth)},3e3)}async function deposittoken(){amount1=document.getElementById("iddeposittokenamount").value,approvetransfer(amount1)}async function approvetransfer(e){tokenaddr=minttokenaddress,erc20=await new web3.eth.Contract(JSON.parse('[{"constant": true,"inputs": [],"name": "name","outputs": [{"name": "","type": "string"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_spender","type": "address"},{"name": "_value","type": "uint256"}],"name": "approve","outputs": [{"name": "","type": "bool"}],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "totalSupply","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_from","type": "address"},{"name": "_to","type": "address"},{"name": "_value","type": "uint256"}],"name": "transferFrom","outputs": [{"name": "","type": "bool"}],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "decimals","outputs": [{"name": "","type": "uint8"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "_owner","type": "address"}],"name": "balanceOf","outputs": [{"name": "balance","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "symbol","outputs": [{"name": "","type": "string"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_to","type": "address"},{"name": "_value","type": "uint256"}],"name": "transfer","outputs": [{"name": "","type": "bool"}],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [{"name": "_owner","type": "address"},{"name": "_spender","type": "address"}],"name": "allowance","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"payable": true,"stateMutability": "payable","type": "fallback"},{"anonymous": false,"inputs": [{"indexed": true,"name": "owner","type": "address"},{"indexed": true,"name": "spender","type": "address"},{"indexed": false,"name": "value","type": "uint256"}],"name": "Approval","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"name": "from","type": "address"},{"indexed": true,"name": "to","type": "address"},{"indexed": false,"name": "value","type": "uint256"}],"name": "Transfer","type": "event"}]'),tokenaddr),toaddress=myContractAddress,amount=1e18*e,bigamount=BigInt(amount),console.log(bigamount);await erc20.methods.approve(toaddress,bigamount).send({from:defaultwalletaddress,gasPrice:mingasprice}),await dextrade2.methods.depositToken(minttokenaddress,bigamount).send({from:defaultwalletaddress,gasPrice:mingasprice});setTimeout(function(){getBalance(useraddr,minttokenaddress)},3e3)}function placebuyorder(){price=document.getElementById("pricebuy").value,amount=document.getElementById("amountbuy").value,taker(price,amount,1)}function placesellorder(){price=document.getElementById("pricesell").value,amount=document.getElementById("amountsell").value,taker(price,amount,2)}async function withdrawether(){amount=document.getElementById("idwithdrawetheramount").value,amount*=1e18,amount=BigInt(amount);await dextrade2.methods.withdraw(amount).send({from:defaultwalletaddress,gasPrice:mingasprice});setTimeout(function(){getBalance(useraddr,eth)},3e3)}async function withdrawtoken(){amount=document.getElementById("idwithdrawtokenamount").value,amount*=1e18,amount=BigInt(amount),tokenaddr=minttokenaddress;await dextrade2.methods.withdrawToken(tokenaddr,amount).send({from:defaultwalletaddress,gasPrice:mingasprice});setTimeout(function(){getBalance(useraddr,minttokenaddress)},3e3)}function updatelasttradedprice(){dextrade2.methods.getlastTradedTransaction().call().then(function(e){timestamp=e[0],lastprice=e[1],lastvolume=e[2],lastoderindex=e[3];var t=document.getElementById("idtableOrderBook").rows[11].cells,n="",a=lastprice/1e9;taghead='<span style="font-weight:bold">',tagtail="</span>",upicon2='<i class="fas fa-long-arrow-alt-up"></i>',upicon=' <i class="fas fa-angle-double-up"></i>',downicon='<i class="fas fa-angle-double-down"></i>',console.log("previouslastradedprice="+previouslastradedprice),a>previouslastradedprice?n=upicon:a<previouslastradedprice&&(n=downicon),previouslastradedprice=a,n==upicon?console.log("UP"):n==downicon&&console.log("DOWN"),formattedprice=taghead+a.toFixed(6)+" "+n+tagtail,t[0].innerHTML=formattedprice,formattedvolume=taghead+lastvolume+tagtail,total=a*lastvolume,formattedtotal=taghead+total.toFixed(6)+tagtail})}function getBalanceNow(){getBalance(useraddr,eth),getBalance(useraddr,minttokenaddress),getWalletBalanceUSD(useraddr),getWalletBalanceMINT(useraddr)}function testReadEvent(){dextrade2.events.Deposit({},{fromBlock:0,toBlock:"latest"}).on("data",function(e){console.log(e),amt=e.returnValues.amount,user=e.returnValues.user,console.log("User="+user),console.log("Amount="+amt)}).on("error",console.error)}function converttimestampto24time(e){return new Date(1e3*e).toLocaleTimeString("en-US",{hour12:!1})}function updatemarkethistory(){dextrade2.events.Trade({},{fromBlock:0,toBlock:"latest"}).on("data",function(e){amt=e.returnValues.amount,price=e.returnValues.price/1e9,ordertype=e.returnValues.takerOrderType,timestamp=e.returnValues.timestamp,console.log("Price="+price+" Amt="+amt+" Ordertype="+ordertype+" timestamp="+timestamp),time24=converttimestampto24time(timestamp);var t=document.getElementById("tableMarketHistory").rows[tablemarkethistroyrow+1].cells;if(timestamp!=lasttradedtimestamp||lasttradedprice!=price||lasttradedamt!=amt){1==ordertype?t[0].innerHTML=price.toFixed(6)+" B":t[0].innerHTML=price.toFixed(6)+" S",t[1].innerHTML=amt;price,amt;t[2].innerHTML=time24+"&nbsp",tablemarkethistroyrow++,0==firsttime&&(setTimeout(function(){updatelasttradedprice()},1e3),setTimeout(function(){refreshOrderBook()},3e3))}lasttradedtimestamp=timestamp,lasttradedprice=price,lasttradedamt=amt}).on("error",console.error)}function trackEventMaker(){dextrade2.events.Maker({},{fromBlock:0,toBlock:"latest"}).on("data",function(e){amt=e.returnValues.amountGive,price=e.returnValues.priceGive,console.log("maker event amt="+amt+" price="+price),1==firsttime||setTimeout(function(){refreshOrderBook()},4e3)}).on("error",console.error)}function getBalance(e,t){dextrade2.methods.getBalance(e,t).call().then(function(e){balance=e[0],tokendecimal=e[1],console.log(balance),console.log(tokendecimal),balance/=10**tokendecimal,console.log(balance),t==eth?(document.getElementById("etherbalance1").innerHTML="You have "+balance.toFixed(3)+" USD on mintDEX",document.getElementById("withdrawusdid").innerHTML="Max "+balance.toFixed(3)+" USD"):(t=minttokenaddress)&&(document.getElementById("gdfbalance1").innerHTML="You have "+balance.toFixed(3)+" MINT on mintDEX",document.getElementById("withdrawminttokenid").innerHTML="Max "+balance.toFixed(3)+" MINT")})}async function getWalletBalanceUSD(e){var t=await web3.eth.getBalance(defaultwalletaddress);t/=1e18,document.getElementById("depositusd").innerHTML="You have "+t.toFixed(3)+" USD"}function getWalletBalanceMINT(e){console.log("getwalletbalancemint");let t=new web3.eth.Contract([{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],type:"function"}],minttokenaddress);(async function(){return bal=await t.methods.balanceOf(e).call(),console.log("Balance=",bal),bal})().then(function(e){bal/=1e18,console.log("after Balance=",bal),document.getElementById("deposittokenid").innerHTML="You have "+bal.toFixed(3)+" MINT"})}function insertWaitingIconForTable(){var e;for(i=0;i<21;i++)10!=i&&((e=document.getElementById("idtableOrderBook").rows[i+1].cells)[0].innerHTML="-",e[1].innerHTML="",e[2].innerHTML="");for(i=8;i<13;i++)(e=document.getElementById("idtableOrderBook").rows[i+1].cells)[0].innerHTML='<i class="fas fa-cog fa-spin"></i>';for((e=document.getElementById("idtableOrderBook").rows[11].cells)[0].innerHTML='<i class="fas fa-spinner fa-spin"></i>',i=0;i<30;i++)(e=document.getElementById("tableMarketHistory").rows[i+1].cells)[0].innerHTML="-",e[1].innerHTML="-",e[2].innerHTML="-"}function refreshOrderBook(){dextrade2.methods.getOrderBookAll().call().then(function(e){var t=Object.keys(e[0]).length,n=[],a=[],r=[],i=[],o=[],d=[],s=0,l=0,u=0,p=0;for(l=0;l<t;l++)1==e[3][l]&&(ordertype=e[0][l],"1"==ordertype?(i[u]=e[1][l],o[u]=e[2][l],i[u]=i[u]/1e9,d[u]=i[u]*o[u],u++):"2"==ordertype&&(n[p]=e[1][l],a[p]=e[2][l],n[p]=n[p]/1e9,r[p]=n[p]*a[p],p++));var m=[];for(l=0;l<u;l++)m[l]=i[l];m.sort().reverse();var c,y,f=[];for(l=0;l<p;l++)f[l]=n[l];for(f.sort(),l=0;l<21;l++){if(10!=l)(b=document.getElementById("idtableOrderBook").rows[l+1].cells)[0].innerHTML="-",b[1].innerHTML="-",b[2].innerHTML="-"}for((c=p)>10&&(c=10),(y=u)>10&&(y=10),l=0;l<c;l++){var b=document.getElementById("idtableOrderBook").rows[10-l].cells;for(s=0;s<p;s++)if(f[l]==n[s]){b[0].innerHTML=n[s].toFixed(6),b[1].innerHTML=a[s],b[2].innerHTML=r[s].toFixed(6);break}}for(l=0;l<y;l++){b=document.getElementById("idtableOrderBook").rows[l+12].cells;for(s=0;s<u;s++)if(m[l]==i[s]){b[0].innerHTML=i[s].toFixed(6),b[1].innerHTML=o[s],b[2].innerHTML=d[s].toFixed(6);break}}i.length>0&&n.length>0&&drawApexChart(i,o,n,a)})}async function maker(e,t,n){var a=minttokenaddress;e*=1e9;await dextrade2.methods.maker(a,e,t,n).send({from:defaultwalletaddress,gasPrice:mingasprice})}async function taker(e,t,n){var a=minttokenaddress;e*=1e9,e=BigInt(e),console.log("price="+e+" amountGive="+t+" orderType="+n);await dextrade2.methods.taker(a,e,t,n).send({from:defaultwalletaddress,gasPrice:mingasprice})}function loadweb3old(){"undefined"!=typeof web3?(console.log("Web3 Detected! "+web3.currentProvider.constructor.name),window.web3=new Web3(web3.currentProvider)):(console.log("No Web3 Detected... using HTTP Provider"),window.web3=new Web3(new Web3.providers.HttpProvider("https:abc")))}function loadweb3oldworking(){return!!window.ethereum&&(window.web3=new Web3(window.ethereum),window.ethereum.enable(),!0)}async function loadweb3(){if(window.ethereum){window.web3=new Web3(ethereum);try{await ethereum.enable();var e=await web3.eth.getAccounts();defaultwalletaddress=e[0],useraddr=defaultwalletaddress,console.log(e)}catch(e){console.log("error.."),console.log(e)}}else window.web3?(window.web3=new Web3(web3.currentProvider),defaultwalletaddress=web3.eth.defaultAccount,useraddr=defaultwalletaddress,console.log("legacy dapp browsers")):console.log("Non-Ethereum browser detected. You should consider trying MetaMask!")}async function init(){previouslastradedprice=0,tablemarkethistroyrow=0,firsttime=1,await loadweb3(),initcontract(),insertWaitingIconForTable(),drawEmptyApexChart(),trackEventMaker(),refreshOrderBook(),updatemarkethistory(),updatelasttradedprice(),getBalanceNow(),firsttime=0}function initcontract(){dextrade2=new web3.eth.Contract(JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"balance","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"tokenAddr","type":"address"},{"indexed":false,"internalType":"uint256","name":"priceGive","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amountGive","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"orderType","type":"uint256"},{"indexed":false,"internalType":"address","name":"makeraddr","type":"address"}],"name":"Maker","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"tokenAddr","type":"address"},{"indexed":false,"internalType":"uint256","name":"priceGet","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amountGet","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"orderType","type":"uint256"},{"indexed":false,"internalType":"address","name":"takeraddr","type":"address"}],"name":"Taker","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"tokenAddr","type":"address"},{"indexed":false,"internalType":"uint256","name":"price","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"takerOrderType","type":"uint256"},{"indexed":false,"internalType":"address","name":"takeraddr","type":"address"},{"indexed":false,"internalType":"address","name":"makeraddr","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"Trade","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"token","type":"address"},{"indexed":false,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"balance","type":"uint256"}],"name":"Withdraw","type":"event"},{"stateMutability":"payable","type":"fallback"},{"inputs":[],"name":"debugprog","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"depositToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"useraddr","type":"address"},{"internalType":"address","name":"tokenaddr","type":"address"}],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getOrderBookAll","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"},{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"num","type":"uint256"}],"name":"getOrderNum","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getlastTradedTransaction","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"tokenAddr","type":"address"},{"internalType":"uint256","name":"priceGive","type":"uint256"},{"internalType":"uint256","name":"amountGive","type":"uint256"},{"internalType":"uint256","name":"orderType","type":"uint256"}],"name":"maker","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"order","outputs":[{"internalType":"uint256","name":"orderID","type":"uint256"},{"internalType":"address","name":"makerAddr","type":"address"},{"internalType":"uint256","name":"orderType","type":"uint256"},{"internalType":"uint256","name":"status","type":"uint256"},{"internalType":"address","name":"tokenAddr","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"uint256","name":"expires","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"tokenAddr","type":"address"},{"internalType":"uint256","name":"priceGet","type":"uint256"},{"internalType":"uint256","name":"amountGet","type":"uint256"},{"internalType":"uint256","name":"orderType","type":"uint256"}],"name":"taker","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"tokendecimal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"tokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"token","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawToken","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),myContractAddress)}function getOrderBook(){return dextrade2.methods.getOrderBookAll().call()}function drawChart(e,t,n,a,r,o,d){var s=(t-e)/n;console.log("eachpricestep="+s);var l=[],u=[],p=[],m=0;for(i=e;i<=t;i+=s)l[m]=e+m*s,u[m]=0,p[m]="rgba(255, 255, 255, 1)",console.log(l[m]),m++;for(purplecolor="rgba(128, 0, 128, 1)",redcolor="rgba(255, 0, 0, 1)",buylen=a.length,console.log("buylen="+buylen),console.log("indexx="+m),j=0;j<m-1;j++)u[j]=0;for(i=0;i<buylen;i++)for(j=0;j<m-1;j++)if(a[i]>=l[j]&&a[i]<l[j+1]){u[j]=u[j]+r[i],p[j]=purplecolor,j=m;break}for(selllen=o.length,console.log("selllen="+selllen),i=0;i<selllen;i++)for(j=0;j<m-1;j++)if(o[i]>=l[j]&&o[i]<l[j+1]){u[j]=d[i],p[j]=redcolor;break}for(i=0;i<m;i++)l[i]="";var c=document.getElementById("myChart").getContext("2d");new Chart(c,{type:"bar",data:{labels:l,datasets:[{data:u,backgroundColor:p}]},options:{legend:{display:!1},scales:{xAxes:[{gridLines:{color:"rgba(0, 0, 0, 0)"},barPercentage:1,categoryPercentage:1,ticks:{fontSize:6,maxRotation:0,minRotation:0}}],yAxes:[{ticks:{beginAtZero:!0,fontSize:4}}]}}})}function convertIpToDecimal(e){if(!/^(\d{0,3}\.){3}.(\d{0,3})$|^(\d{0,3}\.){5}.(\d{0,3})$/.test(e))return!1;for(var t=e.split("."),n=0;n<t.length;n++){var a=t[n];if(a>255||a<0)return!1}return 4==t.length?256*(256*(256*+t[0]+ +t[1])+ +t[2])+ +t[3]:6==t.length&&256*(256*(256*+t[0]+ +t[1])+ +t[2])+256*+t[3]+256*+t[4]+ +t[5]}function httpGet(e){console.log(e),window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:xmlhttp=new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status)return console.log(xmlhttp.responseText),xmlhttp.responseText},xmlhttp.open("GET",e,!1),xmlhttp.send()}function drawEmptyApexChart(){(chart=new ApexCharts(document.querySelector("#myChart"),{chart:{height:380,width:"100%",type:"bar"},dataLabels:{enabled:!1},noData:{text:" "},series:[],xaxis:{type:"numeric",labels:{formatter:function(e){return e.toFixed(6)}}},tooltip:{x:{formatter:function(e){return e.toFixed(6)}}}})).render()}function drawApexChart(e,t,n,a){for(var r=new Array(2),i=0;i<e.length;i++)r[i]=new Array(2);for(i=0;i<e.length;i++)r[i][0]=e[i],r[i][1]=t[i];var o=new Array(2);for(i=0;i<n.length;i++)o[i]=new Array(2);for(i=0;i<n.length;i++)o[i][0]=n[i],o[i][1]=a[i];chart.updateSeries([{name:"BUY",type:"bar",data:r},{name:"SELL",type:"bar",data:o}])}


 
</script>